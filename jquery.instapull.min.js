(function(e,m,r,n){var f;f=function(a,d){this.parameters=e.extend({},{clientId:"",likingBy:"",filterOn:"",sortedBy:"",untilNow:"",afterNow:"",pageSize:20,onWiring:function(){},onPaging:function(){},onFinish:function(){},onNoMore:function(){},onFailed:function(){}},d);if("string"!==typeof this.parameters.clientId||""===this.parameters.clientId)this.parameters.clientId=this.parameters.clientid;"string"!==typeof this.parameters.filterOn&&(this.parameters.filterOn="");this.working={array:[],index:0,queue:""};
this.element=a;this.init()};f.prototype.init=function(){var a=this,d=e(a.element);a.fetch=function(){if("string"===typeof a.parameters.clientId&&""!==a.parameters.clientId){var f=function(){var c="https://api.instagram.com/v1/media/recent";""!==a.parameters.filterOn&&(c="https://api.instagram.com/v1/tags/"+a.parameters.filterOn+"/media/recent");e.getJSON(c+"?client_id="+a.parameters.clientId+"&max_tag_id="+a.working.queue+"&callback=?",function(b){if(null!=b&&"undefined"!==typeof b.meta&&"undefined"!==
typeof b.data){var c=0,g=0,e=!0;if(""!==a.parameters.afterNow)try{g=(new Date(a.parameters.afterNow)).getTime()/1E3}catch(s){g=0}if(""!==a.parameters.untilNow)try{c=(new Date(a.parameters.untilNow)).getTime()/1E3}catch(k){c=0}for(var l=0;l<b.data.length;++l){var h=b.data[l];0<c&&h.created_time>c||0<g&&h.created_time<g||0!==h.likes.count&&(a.working.array[a.working.array.length]=h)}b.pagination.next_max_tag_id===n&&(e=!1);if(!0==e)a.working.queue=b.pagination.next_max_tag_id,f();else{if("function"===
typeof a.parameters.onFinish)try{a.parameters.onFinish(d)}catch(m){}a.working.queue="x";p();q()}}}).fail(function(){if("function"===typeof a.parameters.onFailed)try{a.parameters.onFailed(d)}catch(b){}})},p=function(){"Recent"===a.parameters.sortedBy||"recent"===a.parameters.sortedBy?a.working.array.sort(function(a,b){return b.created_time-a.created_time}):("Likes"===a.parameters.sortedBy||"likes"===a.parameters.sortedBy)&&a.working.array.sort(function(a,b){return b.likes.count-a.likes.count})},q=
function(){if(""!==a.parameters.likingBy){for(var c=[],b=0;b<a.working.array.length;++b)c[b]=e.getJSON("https://api.instagram.com/v1/media/"+a.working.array[b].id+"/likes?client_id="+a.parameters.clientId+"&callback=?",function(){var e=b;return function(b){var c=!1;if("undefined"!==typeof b.data)for(var d=0;d<b.data.length;++d)if(b.data[d].username===a.parameters.likingBy){c=!0;break}!1===c&&(a.working.array[e]=null)}}()).fail(function(){a.working.array[cD]=null});e.when.apply(e,c).then(function(){for(var b=
[],d=0,c=0;c<a.working.array.length;++c)null!=a.working.array[c]&&(b[d]=a.working.array[c],++d);a.working.array=b;a.working.index=0;k()})}else k()},k=function(){for(var c=a.parameters.pageSize;0<c&&a.working.index!==a.working.array.length;){var b=a.working.array[a.working.index];if(null!==b){if("function"!==typeof a.parameters.onAdding)d.append('<img src="'+b.images.thumbnail.url+'" alt="" />');else try{a.parameters.onAdding(d,b)}catch(e){}--c}++a.working.index}if(a.working.index===a.working.array.length&&
"function"===typeof a.parameters.onNoMore)try{a.parameters.onNoMore(d)}catch(f){}};if(a.working.index===a.working.array.length&&"x"!==a.working.queue){if("function"===typeof a.parameters.onPaging)try{a.parameters.onPaging(d)}catch(m){}f()}else k()}else console.error("Fetching requires parameter 'clientId'")};a.reset=function(){a.working.array=[];a.working.index=0;a.working.queue=""};if("function"===typeof a.parameters.onWiring)try{a.parameters.onWiring({fetch:a.fetch.bind(a),reset:a.reset.bind(a)},
d)}catch(f){}};e.fn.instapull=function(a){return this.each(function(){if(e.data(this,"plugin_InstaPull"))e.data(this,"plugin_InstaPull").fetch();else if("object"===typeof a){var d=new f(this,a);e.data(this,"plugin_InstaPull",d);d.fetch()}else console.error("Expected parameters to be passed on first bind (don't forget to include 'clientId')")})}})(jQuery,window,document);
